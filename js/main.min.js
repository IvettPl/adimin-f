/*
 * Custom
 */
$(document).ready(function(){
	$('.js-customscrollbar').mCustomScrollbar();	
	
	$(".js-customscrollbar-yx").mCustomScrollbar({
	    axis:"yx",
	    scrollbarPosition:"outside" 
	});
	
	
	
	
	
	$('.rating-block-content').on('click', function(){
		$(this).toggleClass('open');
	});
	
	
	$('.dop-info-img').on('click', function(){
		$(this).closest('.dop-info-wrap').find('.dop-info-text').addClass('visible');
	});
	
	
	
	
	$('.close').on('click', function(){
		$('.dop-info-text').removeClass('visible'); 
	});	
	
	$('.js-video').on('click', function(){
		$('.overlay').addClass('overlay-visible'); 
	});
	
	$('.js-admin-posts-line').on('click', function(){
		$('.overlay').addClass('overlay-visible'); 
		
	});
	
	$('.popup-close').on('click', function(){
		$('.overlay').removeClass('overlay-visible'); 
	});	
	
	$('.js-profile').on('click', function(){
		$(this).toggleClass('js-profile-open');
	});
	
	
	
	$('.nav__mob-btn').on('click', function(){
		$('.nav').toggleClass('nav-open');
	});
	
	
	$('.nav__item').on('click', function(){
		$('.nav__item').removeClass('active');
		$(this).addClass('active');
		$(this).find('.subnav__list').addClass('active');
	});
	
	
	$('.subnav__list li').on('click', function(){
		$('.subnav__list li').removeClass('active');
		$(this).addClass('active');
	});
	
	
	$.datepicker.setDefaults($.datepicker.regional['ru']);
	$( "#calendar" ).datepicker();
	
	
	
	
		$('.column-templ__nav--desc .list__item').on('click', function(){
			$('.list__item').removeClass('active');
			$(this).addClass('active');
		});
	
	
	
	
		//sort
		$('.column-templ__nav .list__item').on('click', function() {
			$('.column-templ__wrap-area').removeClass('visible');
			var id = $(this).data('sort');
			var active = $('.column-templ__wrap-area').hasClass('js-' + id);
			if(active) {
				$('.column-templ__wrap-area').addClass('hidden');
				$('.js-' + id).addClass('visible');
			}
		});	
	
		//question menu
		$('.column-templ-list .list__title').on('click', function() {
			$(this).next().addClass('list--visible');
		});
	
		$('.column-templ-list .list__item').on('click', function() {
			$('.column-templ__wrap-area').removeClass('visible');
			var itemText = $(this).text();
			var id = $(this).data('sort');
			var active = $('.column-templ__wrap-area').hasClass('js-' + id);
			console.log(active)
			if(active) {
				$('.column-templ__wrap-area').addClass('hidden');
				$('.js-' + id).removeClass('hidden').addClass('visible');
			}
			$(this).parent().prev().text(itemText);
			$(this).parent().removeClass('list--visible');
		});
	
	
	/*checkWidth*/
	  function checkWidth() {
	    var windowWidth = $('body').innerWidth(),
	        elem = $(".column-templ__nav");
	    if(windowWidth < 767){
	      elem.removeClass('column-templ__nav--desc'); 
			$('.column-templ__box-title').on('click', function(e){ 
				$(this).next('.column-templ__box-info').slideToggle();
				$(this).find('.list-arr').toggleClass('open');
			});     
	
	    }
	    else{ 
	      elem.addClass('column-templ__nav--desc');
	    }
	  }
	
	  checkWidth();
	
	  $(window).resize(function(){
	    checkWidth();
	  });
	
	 
	
		var jsDropdown = $('.nav__list li');
	
		jsDropdown.each(function() {			
			$(this).has('ul').addClass('js-dropdown');
		});
});

	( function( factory ) {
		if ( typeof define === "function" && define.amd ) {

			// AMD. Register as an anonymous module.
			define( [ "../widgets/datepicker" ], factory );
		} else {

			// Browser globals
			factory( jQuery.datepicker );
		}
	}

	( function( datepicker ) {

	datepicker.regional.ru = {
		closeText: "Закрыть",
		prevText: "&#x3C;Пред",
		nextText: "След&#x3E;",
		currentText: "Сегодня",
		monthNames: [ "Январь","Февраль","Март","Апрель","Май","Июнь",
		"Июль","Август","Сентябрь","Октябрь","Ноябрь","Декабрь" ],
		monthNamesShort: [ "Янв","Фев","Мар","Апр","Май","Июн",
		"Июл","Авг","Сен","Окт","Ноя","Дек" ],
		dayNames: [ "воскресенье","понедельник","вторник","среда","четверг","пятница","суббота" ],
		dayNamesShort: [ "вск","пнд","втр","срд","чтв","птн","сбт" ],
		dayNamesMin: [ "Вс","Пн","Вт","Ср","Чт","Пт","Сб" ],
		weekHeader: "Нед",
		dateFormat: "dd.mm.yy",
		firstDay: 1,
		isRTL: false,
		showMonthAfterYear: false,
		changeMonth: false,
		numberOfMonths: 1,
		yearSuffix: "" };
	datepicker.setDefaults( datepicker.regional.ru );

	return datepicker.regional.ru;

	}));



	var monthNames = ['', "января","февраля","марта","апреля","мая","июня",
		"июля","августа","сентября","октября","ноября","декабря" ];

	$.datepicker.setDefaults($.datepicker.regional['ru']);
	$( "#calendar" ).datepicker(

		{
			onSelect: function(date, calendar) {
				console.log(calendar);
				loadEvent(calendar.selectedYear, calendar.selectedMonth+1, calendar.selectedDay);
			}
		}
	);
	$( "#calendar" ).change();
	current_day = new Date($( "#calendar" ).datepicker( "getDate" ).getTime() + 3*60*60000);
	loadEvent(current_day.getFullYear(), current_day.getMonth()+1, current_day.getDate());

	//console.log('getdate', $( "#calendar" ).datepicker("option", "selectedMonth" ));

	function loadEvent(y,m,d) {
		if(m<10) m = "0"+m;
		if(d<10) d = "0"+d;
		console.log("loadEvent", y,m,d);
		file = y + '.' + m + '.' + d;
		$.get('/calendar-events/'+file+'.txt', function(data) {

				title = d + ' ' + monthNames[Number(m)];
				markup = '<div class="calendar-block-date">' + title + '</div>';
				markup += "<ul>";

				rows = data.split("\n");
				for (i = 0; i < rows.length; i++) {
					// items = rows[i].match(/^(.+?) (.+?)$/g);
					// time = items[0];
					// text = items[1];
					time = rows[i].substr(0, 5);
					text = rows[i].substr(6);
					markup += '<li><span class="time">' + time + '</span><span>' + text + '</span></li>';

				}
				if(data == '') {
					markup += "<li>В этот день мероприятия не запланированы</li>";
				}
				markup += '</ul>';



			$('.calendar-block-item.slick-slider__item').html(markup);


		});
	}


	function changeDay(offset) {
		day = new Date($( "#calendar" ).datepicker( "getDate" ).getTime() + 3*60*60000);
		next = new Date(day.getTime() + offset*24*60* 60000);
		$( "#calendar" ).datepicker( "setDate", next);
		loadEvent(next.getFullYear(), next.getMonth()+1, next.getDate());
	}